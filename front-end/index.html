<!DOCTYPE html>
<head>
  <title>plots mockup</title>
  <script src="plotly-latest.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
	integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
	crossorigin=""/>

  <!-- Make sure you put this AFTER Leaflet's CSS -->
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
	  integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
	  crossorigin="">
  </script>


</head>

<body>

  <h1>Amazing Noise-meter</h1>
  <div id="tester" style="width:800px;height:500px;"></div>
  <input type="checkbox" id="date" name="date" value="date">
  <label for="date">Change date</label>
  <p>
    Small prototype using leaflet. Final goal would be to be able to select the date you wish to use, and then show all values fetched at this date. Data should be
    pulled from a distributed database through a simple api. 
  </p>
  <script>
    var mymap = L.map('tester').setView([48.117071, -1.639460], 16);
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
	attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
	maxZoom: 18,
	id: 'mapbox.streets',
	accessToken: 'pk.eyJ1Ijoia2xlbSIsImEiOiJjazFxeWZzZnQwMjBuM2xycWV5NGNkejFrIn0.6d2s4vIOcXLI88RUjq5KOA'
    }).addTo(mymap);

    function addCircle(layer, lon, lat, size){
	var col='green'
	
	if(size>90){
	    col="red";
	}else if(size>70){
	    col="orange";
	}else if(size>50){
	    col="yellow";
	}
	
	var circle = L.circle([lon, lat], {
	    color: 'black',
	    fillColor: col,
	    fillOpacity: 0.5,
	    radius: size
	}).addTo(layer);
	circle.bindPopup("Values measured:<br/>Longitude: "+lon+"<br/>Lattitude: "+lat+"<br/>Sound sensor: "+size+" dB");
    }

    
    /*
     JUST FOR THE DEMO
     */
    var layer1 = L.layerGroup();
    points = [[48.117071, -1.639460, 100],[48.116093, -1.636386,20],[48.115040, -1.639862,60], [48.115337, -1.637794,80]];
    for(var i=0;i<points.length;i++){
	addCircle(layer1,points[i][0],points[i][1], points[i][2]);
    }

    var layer2 = L.layerGroup();
    points = [[48.117071, -1.639460, 40],[48.116093, -1.636386,70],[48.115040, -1.639862,55], [48.115337, -1.637794,99]];
    for(var i=0;i<points.length;i++){
	addCircle(layer2,points[i][0],points[i][1], points[i][2]);
    }

    mymap.addLayer(layer1);
    var activelayer=0;
    function onMapClick(e) {
	//alert("a")
	if(!activelayer){
	    mymap.removeLayer(layer1);
	    mymap.addLayer(layer2);
	    activelayer=1;
	}else{
	    mymap.removeLayer(layer2);
	    mymap.addLayer(layer1);
	    activelayer=0;	    
	}
    }

    document.getElementById('date').onclick = onMapClick;

    /*
     END OF DEMO
     */
  </script>
</body>

